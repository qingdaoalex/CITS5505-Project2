{% extends "base.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
<div>
  <table>
    <tr valign="top">
        <td><img src="{{ user.avatar(128) }}"></td>
        <td><h2>User: {{ user.username }}</h2>
          <p>Follower {{user.followers_count()}} Following {{user.following_count()}}</p>

        <h2>Email: {{ user.email }}</h2>
        {% if user.about_me %}<span>{{ user.about_me }}</span>{% endif %}
        {% if user.last_seen %}<span>Last seen on: {{ user.last_seen.strftime('%Y-%m-%d %H:%M:%S') }}</span>{% endif %}
        {% if user == current_user %}
        <p><a href="{{ url_for('edit_profile') }}">Edit your profile</a></p>
        {% elif not current_user.is_following(user) %}
        <p>
            <form action="{{ url_for('follow', username=user.username) }}" method="post">
                {{ form.hidden_tag() }}
                {{ form.submit(value='Follow') }}
            </form>
        </p>
        {% else %}
        <p>
            <form action="{{ url_for('unfollow', username=user.username) }}" method="post">
                {{ form.hidden_tag() }}
                {{ form.submit(value='Unfollow') }}
            </form>
        </p>
        {% endif %}
      </td>
    </tr>
</table>
<hr>
{% for post in posts %}
    {% include '_post.html' %}
{% endfor %}


</div>

<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">

    {% if posts.has_prev %}
     
      <li class="page-item"><a class="page-link" href="{{ url_for('user', username=user.username, page=1) }}">First</a></li>
      <li class="page-item"><a class="page-link" href="{{ prev_url }}">Prev</a></li>
    {% else %}
      
      <li class="page-item disabled"><span class="page-link">First</span></li>
    {% endif %}

    {% if posts.page > 4 %}
      <li class="page-item"><a class="page-link" href="{{ url_for('user', username=user.username, page=1) }}">1</a></li>
      <li class="page-item disabled"><span class="page-link">...</span></li>
    {% endif %}

    {% for p in range(posts.page - 2, posts.page + 3) if p > 0 and p <= posts.pages %}
      <li class="page-item {% if p == posts.page %}active{% endif %}">
        {% if p == posts.page %}
          <span class="page-link">{{ p }}</span>
        {% else %}
          <a class="page-link" href="{{ url_for('user', username=user.username, page=p) }}">{{ p }}</a>
        {% endif %}
      </li>
    {% endfor %}

    {% if posts.page < posts.pages - 3 %}
      <li class="page-item disabled"><span class="page-link">...</span></li>
      <li class="page-item"><a class="page-link" href="{{ url_for('user', username=user.username, page=posts.pages) }}">{{ posts.pages }}</a></li>
    {% endif %}

    {% if posts.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('user', username=user.username, page=posts.next_num) }}">Next</a></li>
      <li class="page-item"><a class="page-link" href="{{ url_for('user', username=user.username, page=posts.pages) }}">Last</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      <li class="page-item disabled"><span class="page-link">Last</span></li>
    {% endif %}

  </ul>
</nav>

{% endblock %}